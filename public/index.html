<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Offline Tools</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }

    button {
      margin-right: 10px;
    }

    pre {
      background: #111;
      color: #0f0;
      padding: 10px;
    }
  </style>
</head>

<body>

  <h2>ğŸ§ª Offline Tools</h2>

  <button onclick="runDns()">Check DNS</button>
  <button onclick="runNpm()">Check NPM</button>

  <br><br>
  <input id="domain" placeholder="example.com" />
  <button onclick="runWhois()">WHOIS</button>

  <pre id="output"></pre>

  <script>
    const output = document.getElementById('output');

    function showLoading(text = 'â³ Loading...') {
      output.textContent = text;
    }

    function showError(err) {
      output.textContent = `âŒ Error:\n${err}`;
    }

    function showResult(data) {
      output.textContent = JSON.stringify(data, null, 2);
    }

    function humanizeDnsResult(item) {
      if (item.success) {
        return `âœ… ${item.name} (${item.ip})
Ù¾Ø§Ø³Ø® Ù…ÙˆÙÙ‚
â±ï¸  ${item.time} ms`;
      }

      let reason = 'Ù†Ø§Ù…Ø´Ø®Øµ';

      if (item.error?.includes('ECONNREFUSED')) {
        reason = 'Ø§ØªØµØ§Ù„ Ø±Ø¯ Ø´Ø¯ (DNS Ù¾Ø§Ø³Ø® Ù†Ø¯Ø§Ø¯)';
      } else if (item.error?.includes('ETIMEOUT')) {
        reason = 'timeout â€“ Ù¾Ø§Ø³Ø® Ù†Ø±Ø³ÛŒØ¯';
      }

      return `âŒ ${item.name} (${item.ip})
Ù†Ø§Ù…ÙˆÙÙ‚
âš ï¸  ${reason}`;
    }


    async function safeFetch(url) {
      try {
        showLoading();
        const res = await fetch(url);

        if (!res.ok) {
          const text = await res.text();
          throw new Error(`${res.status} ${text}`);
        }

        return await res.json();
      } catch (e) {
        showError(e.message);
        throw e;
      }
    }

    async function runDns() {
      try {
        const data = await safeFetch('/api/dns');

        const text = data
          .map(humanizeDnsResult)
          .join('\n\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n');

        output.textContent = text;
      } catch { }

      // try {
      //   const data = await safeFetch('/api/dns');
      //   showResult(data);
      // } catch { }
    }

    async function runNpm() {
      try {
        const data = await safeFetch('/api/npm');
        showResult(data);
      } catch { }
    }

    async function runWhois() {
      const domain = document.getElementById('domain').value.trim();
      if (!domain) {
        showError('Domain is required');
        return;
      }

      try {
        const data = await safeFetch(`/api/whois?domain=${domain}`);
        showResult(data);
      } catch { }
    }
  </script>


</body>

</html>